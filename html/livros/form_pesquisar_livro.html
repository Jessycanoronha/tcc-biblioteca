<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="utf-8">
  <title> Pesquisando Livro | Qg da Leitura </title>
  <link rel="stylesheet" href="../../css/style_form.css">
</head>
<body>
<div class="interface">
	<a class="bt-voltar" href="menu_livro.html"> Menu </a>

  <div class="filtros">
      <h1> Quer pesquisar por? </h1>
      <button class="bt-esc bt_filtro" onclick="mudaEscolha(1)"> Gênero Literário </button>
      <button class="bt-esc bt_filtro" onclick="mudaEscolha(2)"> Escola Literária </button>
      <button class="bt-esc bt_filtro" onclick="mudaEscolha(3)"> Autor </button>
      <button class="bt-esc bt_filtro" onclick="mudaEscolha(4)"> Livro Didático </button>
      <button class="bt-esc bt_filtro" onclick="mudaEscolha(5)"> Livro em especial </button>
  </div>

  <form class="form_imprimir">
    <h1> Pesquise por </h1>
    <!-- Caso seja um livro que ele esteja procurando -->
    <fieldset id="livro">
      <legend> Pesquisar um livro específico</legend>
          <label> Informe o nome do livro para o sistema </label>
          <div>
            <input type="text" placeholder="Digite o titulo do livro" name="titulo" size="35" maxlength="35" id="titulo">
            <button type="button" class="bt_pesquisa confirm" onclick="pesquisarLivro()"> Pesquisar </button>
          </div>
    </fieldset>

    <!-- Caso queira gerar uma lista a partir do genero -->
    <fieldset id="genero">
      <legend> Genero </legend>
      <label> Informe o genero do qual queres a lista: </label>
      <div>
          <select name="genero">
              <option value="a"> Aventura </option>
              <option value="rm"> Romance </option>
              <option value="f"> Ficção </option>
              <option value="tr"> Terror </option>
              <option value="s"> Suspense </option>
              <option value="rp"> Romance Policial </option>
              <option value="p"> Poesia </option>
              <option value="t"> Dramático </option>
              <option value="n" selected> Nenhum </option>
          </select>
          <button type="button" class="bt_pesquisa confirm" onclick="pesquisarGenero()"> Gerar Lista </button>
      </div>
    </fieldset>

    <!-- Caso queira gerar uma lista a partir da escola -->
    <fieldset id="escola">
        <legend> Escola </legend>
        <label> Informe a escola literária do qual queres a lista: </label>
        <div>
            <select name="escola">
                <option value="c"> Clássico </option>
                <option value="h"> Humanismo (Iluminismo) </option>
                <option value="li"> Literatura de informação </option>
                <option value="t"> Trovadorismo </option>
                <option value="a"> Arcadismo </option>
                <option value="b"> Barroco </option>
                <option value="rm"> Romantismo </option>
                <option value="r"> Realismo </option>
                <option value="s"> Simbolismo </option>
                <option value="pem"> Pré-modernismo </option>
                <option value="m"> Modernismo </option>
                <option value="pom"> Pós-modernismo </option>
                <option value="n" selected> Nenhum </option>
                </select>
            <button type="button" class="bt_pesquisa confirm" onclick="pesquisarEscola()"> Gerar Lista </button>
        </div>
    </fieldset>

    <!-- Caso queira gerar uma lista a partir do tipo didático -->
    <fieldset id="didatico">
      <legend> Didático </legend>
      <label> Informe a categoria didática do qual queres a lista: </label>
      <div>
        <select name="didatico">
            <option value="fs"> Filosofia/Sociologia </option>
            <option value="mf"> Matemática/Física </option>
            <option value="pl"> Português/Literatura </option>
            <option value="b"> Biológicas </option>
            <option value="h"> Historia </option>
            <option value="g"> Geografia </option>
            <option value="p"> Pedagógicos </option>
            <option value="e"> Enciclopédias </option>
            <option value="d"> Dicionários </option>
            <option value="n" selected> Nenhum </option>
        </select>
        <button type="button" class="bt_pesquisa confirm" onclick="pesquisarDidatico()"> Gerar Lista </button>
        </div>
    </fieldset>

    <!-- Caso queira gerar uma lista a partir de um autor(ra) -->
    <fieldset id="autor">
      <legend> Pesquisar por autor </legend>
        <label> Informe o nome do autor para o sitema </label>
        <div>
          <input type="text" maxlength="35" size="35" name="autor" placeholder="Digite um nome de autor" id="author">
          <button type="button" class="bt_pesquisa confirm" onclick="pesquisarAutor()"> Pesquisar </button>
        </div>
    </fieldset>

      <!-- Caso queira voltar aos filtros -->
      <button class="bt bt_filtro confirm" type="button" onclick="voltarFiltros()"> Voltar aos filtros </button>
  </form>

  <div class="resposta"></div>
  <script>
    var divResposta = document.getElementsByClassName("resposta")[0];
    document.getElementsByClassName("form_imprimir")[0].style.display = "none"; // Sumindo com o formulário
    function mudaEscolha(x){
        document.getElementsByClassName("form_imprimir")[0].style.display = "block";
        document.getElementsByClassName("filtros")[0].style.display = "none";
        if(x === 1){
            document.getElementById("genero").style.display = "block";
        }else if(x === 2){
            document.getElementById("escola").style.display = "block";
        }else if(x === 3){
            document.getElementById("autor").style.display = "block";
        }else if(x === 4){
            document.getElementById("didatico").style.display = "block";
        }else{
            document.getElementById("livro").style.display = "block";
        }
    }

    // Função que volta aos filtros
    function voltarFiltros(){
        divResposta.style.display = "none";
        document.getElementsByClassName("form_imprimir")[0].style.display = "none"; // Sumindo com o form novamente
        document.getElementsByClassName("filtros")[0].style.display = "flex";
        document.getElementById("genero").style.display = "none";
        document.getElementById("escola").style.display = "none";
        document.getElementById("autor").style.display = "none";
        document.getElementById("didatico").style.display = "none";
        document.getElementById("livro").style.display = "none";
    }

    // Função que busca um livro em específico e exibe o resultado
    function pesquisarLivro() {
      divResposta.style.display = "block";
      var titulo = document.getElementById("titulo").value;
      var http = new XMLHttpRequest();

      http.onreadystatechange = function() {
        if(http.readyState == 4 && http.status == 200) {
          var resposta = http.responseText;
          divResposta.innerHTML = resposta;
        } else {
          divResposta.innerHTML = "<p> Carregando </p>";
        }
      }

      http.open("GET", "http://127.0.0.1/tcc-biblioteca/php/arq_livros/pesquisa_livro.php?titulo=" + titulo, true);
      http.send();
    }

    // Função que gera o botao para mostrar os dados do livro
    function respondeChecked() {
      var id = document.querySelector("input[type='radio']:checked").value;
      // Armazenando o id do aluno no localStorage
      localStorage.setItem("cod", id);

      if(!(document.querySelector(".resposta button"))) {
        var text = document.createTextNode("Ver dados do livro"),
            button = document.createElement("button");

        // Criando o butao
        button.setAttribute("class", "bt confirm");
        button.appendChild(text);
        divResposta.appendChild(button);

        // Chamando a função que irá fazer a requisição ajax para saber se o aluno está ou não com livro emprestado
        button.addEventListener("click", mostrarDados);
      }
    }

    // Função que faz requisição no banco de dados e mostra os dados do aluno
    function mostrarDados() {
      var cod = localStorage.getItem("cod");

      var http = new XMLHttpRequest();

      http.onreadystatechange = function() {
        if (http.readyState == 4 && http.status == 200) {
          var resposta = http.responseText;
          divResposta.style.display = "block";
          divResposta.innerHTML = resposta;
        } else {
          divResposta.style.display = "block";
          divResposta.innerHTML = "<p> Carregando... </p>";
        }
      }

      http.open("GET", "http://127.0.0.1/tcc-biblioteca/php/arq_livros/mostrarDados.php?query=" + cod, true);
      http.send();
    }

    // Função que busca os livros pelo genero
    function pesquisarGenero() {
      divResposta.style.display = "block";

      var genero = document.getElementsByName("genero")[0].value;
      var http = new XMLHttpRequest();

      http.onreadystatechange = function() {
        if (http.readyState == 4 && http.status == 200) {
          var resposta = http.responseText;
          divResposta.style.display = "block";
          divResposta.innerHTML = resposta;
        } else {
          divResposta.style.display = "block";
          divResposta.innerHTML = "<p> Carregando... </p>";
        }
      }

      http.open("GET", "http://127.0.0.1/tcc-biblioteca/php/arq_livros/pesquisa_livro.php?genero=" + genero, true);
      http.send();
    }

    // Função que pesquisa os livros pela escola literaria
    function pesquisarEscola() {
      divResposta.style.display = "block";

      var escola = document.getElementsByName("escola")[0].value;
      var http = new XMLHttpRequest();

      http.onreadystatechange = function() {
        if (http.readyState == 4 && http.status == 200) {
          var resposta = http.responseText;
          divResposta.style.display = "block";
          divResposta.innerHTML = resposta;
        } else {
          divResposta.style.display = "block";
          divResposta.innerHTML = "<p> Carregando... </p>";
        }
      }

      http.open("GET", "http://127.0.0.1/tcc-biblioteca/php/arq_livros/pesquisa_livro.php?escola=" + escola, true);
      http.send();
    }

    // Função que pesquisa os livros pelo didatismo
    function pesquisarDidatico() {
      divResposta.style.display = "block";

      var didatico = document.getElementsByName("didatico")[0].value;
      var http = new XMLHttpRequest();

      http.onreadystatechange = function() {
        if (http.readyState == 4 && http.status == 200) {
          var resposta = http.responseText;
          divResposta.style.display = "block";
          divResposta.innerHTML = resposta;
        } else {
          divResposta.style.display = "block";
          divResposta.innerHTML = "<p> Carregando... </p>";
        }
      }

      http.open("GET", "http://127.0.0.1/tcc-biblioteca/php/arq_livros/pesquisa_livro.php?didatico=" + didatico, true);
      http.send();
    }

    // Função que pesquisa os livros pelo autor
    function pesquisarAutor() {
      divResposta.style.display = "block";

      var autor = document.getElementById("author").value;
      var http = new XMLHttpRequest();

      http.onreadystatechange = function() {
        if (http.readyState == 4 && http.status == 200) {
          var resposta = http.responseText;
          divResposta.style.display = "block";
          divResposta.innerHTML = resposta;
        } else {
          divResposta.style.display = "block";
          divResposta.innerHTML = "<p> Carregando... </p>";
        }
      }

      http.open("GET", "http://127.0.0.1/tcc-biblioteca/php/arq_livros/pesquisa_livro.php?autor=" + autor, true);
      http.send();
    }
  </script>
	</div>
	</body>
</html>
