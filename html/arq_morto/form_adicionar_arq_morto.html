<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="utf-8">
  <title> Adicionando Livros do Arquivo Morto ao Cadastro | Qg da Leitura </title>
  <link rel="stylesheet" href="../../css/style_form.css">
</head>
<body>
<div class="interface">
	<a class="btn bt-voltar" href="menu_arquivo_morto.html"> Menu </a>

	<h1> Adicionar livro de arquivo morto ao cadastro </h1>
	<form class="frm frm-large">
		<fieldset>
    	<legend> Informações do livro </legend>
      <div class="col-large">
          <label> Título </label>
          <input type="text" placeholder="Digite o título do livro" name="titulo" maxlength="35" autofocus id="titulo" >
      </div>
      <div class="col-large">
          <label> Autor </label>
          <input type="text" placeholder="Digite o autor do livro" name="autor" maxlength="35" id="autor" >
      </div>
      <div class="col-large">
          <label> Editora </label>
          <input type="text" placeholder="Digite a editora do livro" name="editora" maxlength="35" id="editora" >
      </div>
      <div class="col-tres">
        <div>
          <label> Gaveta </label>
          <input type="number" name="gaveta" min="0" maxlength="2" id="gaveta">
        </div>
        <div>
          <label> Livro </label>
          <input type="number" name="livro" min="0" maxlength="3" id="livro">
        </div>
        <div>
          <label> Estoque </label>
          <input type="number" name="estoque" min="0" placeholder="Estoque" id="estoque">
        </div>
      </div>
      <div class="div-butoes">
          <button type="button" class="btn confirm" id="btn-confirm"> Confirmar </button>
          <button type="button" class="btn alert" id="btn-reset"> Resetar </button>
      </div>
	  </fieldset>
	</form>
  <div class="resposta">
    <p id="resposta"></p>
    <button class="btn filtro" type="button" onclick="voltarAdicionar()"> Voltar a adicionar </button>
  </div>
  <script>
    "use strict";
    let btn_conf = document.getElementById("btn-confirm"),
        btn_reset = document.getElementById("btn-reset");

    function validar(tt, aut, edit) {
      if(tt == "") {
        alert("O campo título está em branco, digite alguma coisa");
        document.getElementById("titulo").focus();
        return false;
      } else if (aut == "") {
        alert("O campo autor está em branco");
        document.getElementById("autor").focus();
        return false;
      } else if (edit == "") {
        alert("O campo editora está em branco");
        document.getElementById("editora").focus();
        return false;
      } else {
        return true;
      }
    }

    btn_conf.addEventListener("click", function() {
      // Recuperando os dados dos formulários
      var titulo  = document.getElementById("titulo").value,
          autor = document.getElementById("autor").value,
          editora = document.getElementById("editora").value,
          gaveta = document.getElementById("gaveta").value,
          livro = document.getElementById("livro").value,
          estoque = document.getElementById("estoque").value;

      var result = validar(titulo, autor, editora);

      if (result) {
        // Fazendo surgir a tela de resposta
        document.getElementsByClassName("resposta")[0].style.display = "block";
        document.getElementsByClassName("frm")[0].style.display = "none";

        // Realizando a requisição ajax
        var http = new XMLHttpRequest();

        http.onreadystatechange = function() {
          if (http.readyState == 4 && http.status == 200) {
            var resposta = http.responseText;
            document.getElementsByClassName("resposta")[0].style.display = "block";
            document.getElementById("resposta").innerHTML = resposta;
          } else {
            document.getElementsByClassName("resposta")[0].style.display = "block";
            document.getElementById("resposta").innerHTML = "Carregando";
          }
        }

        http.open("GET", "http://127.0.0.1/tcc-biblioteca/php/arq_morto/adicionar_livro.php?titulo=" + titulo + "&autor=" + autor + "&editora=" + editora + "&gaveta=" + gaveta + "&livro=" + livro + "&estoque=" + estoque, true);
        http.send(null);
      }

    });

    btn_reset.addEventListener("click", resetar);

    function resetar() {
      // "Limpando" os campos
      document.getElementById("titulo").value = "";
      document.getElementById("titulo").focus();
      document.getElementById("autor").value = "";
      document.getElementById("editora").value = "";
      document.getElementById("gaveta").value = "";
      document.getElementById("livro").value = "";
      document.getElementById("estoque").value = "";
      document.getElementsByClassName("resposta")[0].style.display = "none";
      document.getElementById("resposta").innerHTML = "";
    };

    function voltarAdicionar() {
      // Voltando com o frm
      document.getElementsByClassName("resposta")[0].style.display = "none";
      document.getElementsByClassName("frm")[0].style.display = "block";
      resetar();
    }
  </script>
  </div>
</body>
</html>
