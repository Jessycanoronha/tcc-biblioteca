<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="utf-8">
  <title> Adicionando Alunos ao Cadastro | Qg da Leitura </title>
  <link rel="stylesheet" href="../../css/style_form.css">
</head>
<body>
<div class="interface">
  <a class="btn bt-voltar" href="menu_aluno.html"> Menu </a>

  <h1> Adicionar aluno ao cadastro </h1>

  <form class="frm frm-medium">
      <fieldset>
          <legend> Informações pessoais </legend>
          <div class="col-large">
             <label for="nome">Nome: </label>
             <input type="text" name="nome" placeholder="Digite o nome do aluno" maxlength="35" autofocus id="nome" required>
          </div>
          <div class="col-large">
             <label for="turma">Turma: </label>
             <input type="number" name="turma" placeholder="Ex.:1002" id="turma" min="1000" max="9999" required maxlength="4">
          </div>
          <div class="div-butoes">
              <button type="button" class="btn confirm" id="btn-confirm"> Confirmar </button>
              <button type="button" class="btn alert" id="btn-reset"> Resetar </button>
          </div>
      </fieldset>
  </form>
  <div class="resposta">
    <p id="resposta"></p>
    <button class="btn filtro" type="button" onclick="voltarAdicionar()"> Voltar a adicionar </button>
  </div>
  <script>
    "use strict";
    let btn_conf = document.getElementById("btn-confirm"),
        btn_reset = document.getElementById("btn-reset");

    btn_conf.addEventListener("click", function() {
      // Recuperando os dados dos formulários
      var nome = document.getElementById("nome").value;
      var turma = document.getElementById("turma").value;

      // Executando a verificação
      if(nome == "") {
        alert("Digite um nome válido");
        document.getElementById("nome").focus();
      } else if (/[^\D]/.test(nome)) {
        alert("Foi digitado número em meio a letra no nome do aluno");
        document.getElementById("nome").focus();
      } else if(turma == "") {
        alert("Digite um número de turma válido");
        document.getElementById("turma").focus();
      } else if(turma > 9999) {
        alert("Foi digitado um valor maior que 9999 na turma");
        document.getElementById("turma").focus();
      } else {
        insereDados(nome, turma); // Chamando a função de inserção de dados no banco de dados
      }
    });

    function insereDados(nome, turma) {
      // Fazendo surgir a tela de resposta
      document.getElementsByClassName("resposta")[0].style.display = "block";
      document.getElementsByClassName("frm")[0].style.display = "none";

      // Realizando a requisição ajax
      var http = new XMLHttpRequest();

      http.onreadystatechange = function() {
        if (http.readyState == 4 && http.status == 200) {
          var resposta = http.responseText;
          document.getElementsByClassName("resposta")[0].style.display = "block";
          document.getElementById("resposta").innerHTML = resposta;
        } else {
          document.getElementsByClassName("resposta")[0].style.display = "block";
          document.getElementById("resposta").innerHTML = "Carregando";
        }
      }

      http.open("GET", "http://127.0.0.1/tcc-biblioteca/php/arq_alunos/adicionar_aluno.php?nome=" + nome + "&turma=" + turma, true);
      http.send(null);
    }

    btn_reset.addEventListener("click", resetar);
    function resetar() {
      // "Limpando" os campos
      document.getElementById("nome").value = "";
      document.getElementById("nome").focus();
      document.getElementById("turma").value = "";
      document.getElementsByClassName("resposta")[0].style.display = "none";
      document.getElementById("resposta").innerHTML = "";
    };

    function voltarAdicionar() {
      // Voltando com o frm
      document.getElementsByClassName("resposta")[0].style.display = "none";
      document.getElementsByClassName("frm")[0].style.display = "block";
      resetar();
    }
  </script>
  </div>
</body>
</html>
